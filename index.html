<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script defer src="script.js"></script>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

    <!-- Main Content -->
    <main class="container mx-auto mt-6 flex-grow">
        <div id="authContainer" class="hidden">
            <div id="registerForm" class="hidden">
                <h2 class="text-xl mb-4">Register</h2>
                <input type="text" id="registerUsername" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Username">
                <input type="password" id="registerPassword" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Password">
                <button id="registerBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Register</button>
                <button id="showLoginForm" class="text-blue-500 mt-2">Already have an account? Login</button>
            </div>
            <div id="loginForm" class="hidden">
                <h2 class="text-xl mb-4">Login</h2>
                <input type="text" id="loginUsername" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Username">
                <input type="password" id="loginPassword" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Password">
                <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Login</button>
                <button id="showRegisterForm" class="text-blue-500 mt-2">Don't have an account? Register</button>
            </div>
        </div>
        <div id="forumContainer" class="hidden">
            <div class="flex justify-end mb-4">
                <input type="text" id="searchInput" class="w-full md:w-1/3 p-2 border border-gray-300 rounded" placeholder="Search posts by title or tag">
            </div>
            <div id="postsContainer">
                <!-- Posts will be dynamically inserted here -->
            </div>
        </div>
    </main>

    <!-- Navigation -->
    <nav class="bg-blue-500 p-4 fixed bottom-0 inset-x-0">
        <div class="container mx-auto flex justify-between">
            <h1 class="text-white text-2xl">Forum</h1>
            <div id="authLinks" class="text-white flex space-x-4 items-center">
                <!-- Authentication Links will be inserted here -->
                <button id="newPostBtn" class="bg-green-500 text-white px-4 py-2 rounded">
                    <i class="fas fa-plus"></i> New Post
                </button>
            </div>
        </div>
    </nav>

    <!-- Modal for New Post -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded w-11/12 md:w-2/3 lg:w-1/2">
            <h2 class="text-xl mb-4">New Post</h2>
            <input type="text" id="postTitle" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Title">
            <textarea id="postContent" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Content"></textarea>
            <input type="text" id="postTags" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Tags (comma separated)">
            <div class="flex justify-end">
                <button id="savePostBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Save</button>
                <button id="cancelPostBtn" class="ml-2 bg-red-500 text-white px-4 py-2 rounded">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for Edit Post -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded w-11/12 md:w-2/3 lg:w-1/2">
            <h2 class="text-xl mb-4">Edit Post</h2>
            <input type="text" id="editPostTitle" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Title">
            <textarea id="editPostContent" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Content"></textarea>
            <input type="text" id="editPostTags" class="w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Tags (comma separated)">
            <div class="flex justify-end">
                <button id="updatePostBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Update</button>
                <button id="cancelEditPostBtn" class="ml-2 bg-red-500 text-white px-4 py-2 rounded">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const authLinks = document.getElementById('authLinks');
            const authContainer = document.getElementById('authContainer');
            const forumContainer = document.getElementById('forumContainer');
            const registerForm = document.getElementById('registerForm');
            const loginForm = document.getElementById('loginForm');
            const showLoginForm = document.getElementById('showLoginForm');
            const showRegisterForm = document.getElementById('showRegisterForm');
            const registerBtn = document.getElementById('registerBtn');
            const loginBtn = document.getElementById('loginBtn');
            const registerUsername = document.getElementById('registerUsername');
            const registerPassword = document.getElementById('registerPassword');
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');

            const newPostBtn = document.getElementById('newPostBtn');
            const modal = document.getElementById('modal');
            const editModal = document.getElementById('editModal');
            const cancelPostBtn = document.getElementById('cancelPostBtn');
            const savePostBtn = document.getElementById('savePostBtn');
            const updatePostBtn = document.getElementById('updatePostBtn');
            const cancelEditPostBtn = document.getElementById('cancelEditPostBtn');
            const postTitle = document.getElementById('postTitle');
            const postContent = document.getElementById('postContent');
            const postTags = document.getElementById('postTags');
            const editPostTitle = document.getElementById('editPostTitle');
            const editPostContent = document.getElementById('editPostContent');
            const editPostTags = document.getElementById('editPostTags');
            const postsContainer = document.getElementById('postsContainer');
            const searchInput = document.getElementById('searchInput');

            let users = JSON.parse(localStorage.getItem('users')) || [];
            let posts = JSON.parse(localStorage.getItem('posts')) || [];
            let currentUser = JSON.parse(localStorage.getItem('currentUser'));
            let currentEditPostId = null;

            if (currentUser) {
                showForum();
            } else {
                showAuthForms();
            }

            registerBtn.addEventListener('click', () => {
                const username = registerUsername.value.trim();
                const password = registerPassword.value.trim();
                if (username && password && !users.some(user => user.username === username)) {
                    users.push({ username, password });
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('Registration successful!');
                    showLoginForm.click();
                } else {
                    alert('Username already exists or invalid inputs.');
                }
            });

            loginBtn.addEventListener('click', () => {
                const username = loginUsername.value.trim();
                const password = loginPassword.value.trim();
                const user = users.find(user => user.username === username && user.password === password);
                if (user) {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showForum();
                } else {
                    alert('Invalid username or password.');
                }
            });

            showLoginForm.addEventListener('click', () => {
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });

            showRegisterForm.addEventListener('click', () => {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            });

            newPostBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });

            cancelPostBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            savePostBtn.addEventListener('click', () => {
                const title = postTitle.value.trim();
                const content = postContent.value.trim();
                const tags = postTags.value.trim().split(',').map(tag => tag.trim()).filter(tag => tag);
                if (title && content) {
                    const post = { id: Date.now(), title, content, comments: [], username: currentUser.username, likes: 0, views: 0, tags };
                    posts.push(post);
                    localStorage.setItem('posts', JSON.stringify(posts));
                    renderPosts();
                    modal.classList.add('hidden');
                    postTitle.value = '';
                    postContent.value = '';
                    postTags.value = '';
                }
            });

            cancelEditPostBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
            });

            updatePostBtn.addEventListener('click', () => {
                const title = editPostTitle.value.trim();
                const content = editPostContent.value.trim();
                const tags = editPostTags.value.trim().split(',').map(tag => tag.trim()).filter(tag => tag);
                if (title && content && currentEditPostId !== null) {
                    const post = posts.find(p => p.id === currentEditPostId);
                    post.title = title;
                    post.content = content;
                    post.tags = tags;
                    localStorage.setItem('posts', JSON.stringify(posts));
                    renderPosts();
                    editModal.classList.add('hidden');
                    currentEditPostId = null;
                }
            });

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim().toLowerCase();
                renderPosts(query);
            });

            function renderPosts(query = '') {
                postsContainer.innerHTML = '';
                const filteredPosts = posts.filter(post => post.title.toLowerCase().includes(query) || post.tags.some(tag => tag.toLowerCase().includes(query)));
                filteredPosts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('bg-white', 'p-4', 'mb-4', 'rounded', 'shadow');
                    postElement.innerHTML = `
                        <h3 class="text-xl font-bold">${post.title}</h3>
                        <p>${post.content}</p>
                        <p class="text-sm text-gray-500">Posted by ${post.username}</p>
                        <p class="text-sm text-gray-500">Views: ${post.views} | Likes: ${post.likes}</p>
                        <div class="flex space-x-2 mt-2">
                            ${post.tags.map(tag => `<span class="text-xs bg-gray-200 px-2 py-1 rounded">${tag}</span>`).join('')}
                        </div>
                        <div class="flex justify-between mt-2">
                            <button onclick="viewPost(${post.id})" class="text-blue-500">View Comments</button>
                            <div class="flex space-x-2">
                                <button onclick="toggleLike(${post.id})" class="text-green-500"><i class="fas fa-thumbs-up"></i>${post.likedBy.includes(currentUser.username) ? ' Unlike' : ' Like'}</button>
                                ${post.username === currentUser.username ? `
                                    <button onclick="editPost(${post.id})" class="text-yellow-500"><i class="fas fa-edit"></i> Edit</button>
                                    <button onclick="deletePost(${post.id})" class="text-red-500"><i class="fas fa-trash"></i> Delete</button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    postsContainer.appendChild(postElement);
                });
            }

            function showForum() {
                authContainer.classList.add('hidden');
                forumContainer.classList.remove('hidden');
                authLinks.innerHTML = `<button id="logoutBtn" class="bg-red-500 px-4 py-2 rounded">Logout</button>`;
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    localStorage.removeItem('currentUser');
                    currentUser = null;
                    showAuthForms();
                });
                renderPosts();
            }

            function showAuthForms() {
                authContainer.classList.remove('hidden');
                forumContainer.classList.add('hidden');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                authLinks.innerHTML = '';
            }

            window.viewPost = function(postId) {
                const post = posts.find(p => p.id === postId);
                if (post) {
                    post.views += 1;
                    localStorage.setItem('posts', JSON.stringify(posts));
                    postsContainer.innerHTML = `
                        <div class="bg-white p-4 mb-4 rounded shadow">
                            <h3 class="text-xl font-bold">${post.title}</h3>
                            <p>${post.content}</p>
                            <p class="text-sm text-gray-500">Posted by ${post.username}</p>
                            <p class="text-sm text-gray-500">Views: ${post.views} | Likes: ${post.likes}</p>
                            <h4 class="text-lg mt-4">Comments</h4>
                            <div id="commentsContainer">
                                ${post.comments.map((comment, index) => `
                                    <div class="mt-2 flex justify-between items-start">
                                        <p>${comment.text} <span class="text-sm text-gray-500">(by ${comment.username})</span></p>
                                        ${comment.username === currentUser.username ? `
                                            <div class="flex space-x-2">
                                                <button onclick="editComment(${post.id}, ${index})" class="text-yellow-500"><i class="fas fa-edit"></i> Edit</button>
                                                <button onclick="deleteComment(${post.id}, ${index})" class="text-red-500"><i class="fas fa-trash"></i> Delete</button>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            <textarea id="newComment" class="w-full mt-4 p-2 border border-gray-300 rounded" placeholder="Add a comment"></textarea>
                            <button onclick="addComment(${post.id})" class="bg-blue-500 text-white px-4 py-2 rounded mt-2">Comment</button>
                            <button onclick="renderPosts()" class="bg-gray-500 text-white px-4 py-2 rounded mt-2">Back</button>
                        </div>
                    `;
                }
            }

            window.addComment = function(postId) {
                const newComment = document.getElementById('newComment').value.trim();
                if (newComment) {
                    const post = posts.find(p => p.id === postId);
                    post.comments.push({ text: newComment, username: currentUser.username });
                    localStorage.setItem('posts', JSON.stringify(posts));
                    viewPost(postId);
                }
            }

            window.editPost = function(postId) {
                const post = posts.find(p => p.id === postId);
                if (post && post.username === currentUser.username) {
                    currentEditPostId = postId;
                    editPostTitle.value = post.title;
                    editPostContent.value = post.content;
                    editPostTags.value = post.tags.join(', ');
                    editModal.classList.remove('hidden');
                }
            }

            window.deletePost = function(postId) {
                const postIndex = posts.findIndex(p => p.id === postId);
                if (postIndex !== -1 && posts[postIndex].username === currentUser.username) {
                    if (confirm('Are you sure you want to delete this post?')) {
                        posts.splice(postIndex, 1);
                        localStorage.setItem('posts', JSON.stringify(posts));
                        renderPosts();
                    }
                }
            }

            window.editComment = function(postId, commentIndex) {
                const post = posts.find(p => p.id === postId);
                const comment = post.comments[commentIndex];
                if (comment && comment.username === currentUser.username) {
                    const newCommentText = prompt('Edit your comment:', comment.text);
                    if (newCommentText !== null) {
                        comment.text = newCommentText;
                        localStorage.setItem('posts', JSON.stringify(posts));
                        viewPost(postId);
                    }
                }
            }

            window.deleteComment = function(postId, commentIndex) {
                const post = posts.find(p => p.id === postId);
                const comment = post.comments[commentIndex];
                if (comment && comment.username === currentUser.username) {
                    if (confirm('Are you sure you want to delete this comment?')) {
                        post.comments.splice(commentIndex, 1);
                        localStorage.setItem('posts', JSON.stringify(posts));
                        viewPost(postId);
                    }
                }
            }

            window.toggleLike = function(postId) {
                const post = posts.find(p => p.id === postId);
                if (post) {
                    if (post.likedBy.includes(currentUser.username)) {
                        post.likes -= 1;
                        post.likedBy = post.likedBy.filter(username => username !== currentUser.username);
                    } else {
                        post.likes += 1;
                        post.likedBy.push(currentUser.username);
                    }
                    localStorage.setItem('posts', JSON.stringify(posts));
                    renderPosts();
                }
            }
        });
    </script>
</body>
</html>
